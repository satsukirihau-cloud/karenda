<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³PWAç‰ˆï¼‰</title>

  <!-- âœ… iOSãƒ›ãƒ¼ãƒ ç”»é¢å¯¾å¿œ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼">
  <link rel="apple-touch-icon" href="icon-192.png">

  <!-- âœ… PWAè¨­å®š -->
  <link rel="manifest" href="manifest.json">

  <style>
    :root {
      --bg: #f8fafc;
      --fg: #0f172a;
      --accent: #2563eb;
      --border: #cbd5e1;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: "Meiryo", "Segoe UI", sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      user-select: none;
      -webkit-user-select: none;
    }

    input {
      user-select: auto;
      -webkit-user-select: auto;
    }

    h1 {
      margin: 16px 0;
      font-size: 28px;
      text-align: center;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    button {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
    }

    button:hover {
      opacity: 0.9;
    }

    .calendar {
      width: 95%;
      max-width: 900px;
      border-collapse: collapse;
      margin-bottom: 30px;
      table-layout: fixed;
    }

    .calendar th {
      background: #e2e8f0;
      padding: 8px;
      font-weight: 600;
    }

    .calendar td {
      border: 1px solid var(--border);
      width: 14.2%;
      vertical-align: top;
      height: 110px;
      padding: 6px;
      position: relative;
    }

    .calendar td:hover {
      background: #f1f5f9;
    }

    .date-num {
      font-weight: bold;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .event {
      background: #3b82f6;
      color: white;
      border-radius: 4px;
      padding: 4px 6px;
      font-size: 13px;
      margin: 2px 0;
      word-wrap: break-word;
      cursor: grab;
    }

    .event:active {
      cursor: grabbing;
      opacity: 0.7;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      z-index: 10;
    }

    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
    }

    .modal-content h2 {
      margin-top: 0;
    }

    input {
      width: 100%;
      padding: 8px;
      margin: 6px 0;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .time-inputs {
      display: flex;
      align-items: center;
      gap: 5px;
      margin: 6px 0;
    }

    .time-inputs input {
      width: 60px;
      text-align: center;
    }

    @media print {
      @page {
        size: A4 portrait;
        margin: 10mm;
      }

      body {
        background: white;
        color: black;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }

      .controls,
      .modal {
        display: none !important;
      }

      h1 {
        font-size: 24px;
        margin: 0 0 10px 0;
        text-align: left;
      }

      .calendar {
        width: 100%;
        /* ãƒšãƒ¼ã‚¸ã®æ®‹ã‚Šã®é«˜ã•ã‚’è¨ˆç®— (ã‚¿ã‚¤ãƒˆãƒ«åˆ†ã‚’é™¤ã) */
        height: calc(100vh - 50px);
        table-layout: fixed;
      }

      .calendar th {
        background: white;
        border: 1px solid black;
        padding: 4px;
        height: 30px;
      }

      .calendar td {
        border: 1px solid black;
        /* è¡Œã®é«˜ã•ã‚’å‡ç­‰ã«åºƒã’ã‚‹ */
        height: auto;
        vertical-align: top;
        padding: 4px;
      }

      /* è¡Œã®é«˜ã•ã‚’å¼·åˆ¶çš„ã«å‡ç­‰åŒ–ã™ã‚‹ãŸã‚ã«trã«é«˜ã•ã‚’æŒ‡å®š */
      .calendar tr {
        height: 1fr;
      }

      .event {
        font-size: 11px;
        background: white;
        color: black;
        border: 1px solid black;
        box-shadow: none;
        margin: 1px 0;
        padding: 2px;
      }
    }
  </style>
</head>

<body>
  <h1 id="monthTitle"></h1>
  <div class="controls">
    <button id="prevBtn">â† å‰ã®æœˆ</button>
    <button id="todayBtn">ä»Šæ—¥</button>
    <button id="nextBtn">æ¬¡ã®æœˆ â†’</button>
    <button id="copyMonthBtn" style="background:#8b5cf6;">ä»Šæœˆã®äºˆå®šã‚’æ¥æœˆã«ã‚³ãƒ”ãƒ¼</button>
    <button id="deleteMonthBtn" style="background:#ef4444;">ä»Šæœˆã®äºˆå®šã‚’å…¨ã¦å‰Šé™¤</button>
    <button id="printBtn">ğŸ–¨ å°åˆ·</button>
  </div>
  <table class="calendar" id="calendar"></table>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <h2 id="modalDate"></h2>
      <input type="text" id="eventTitle" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
      <div style="margin: 6px 0;">
        <label style="font-size:12px;">ã‚³ãƒ”ãƒ¼åŸºæº–æ›œæ—¥:</label>
        <select id="eventWeekday" style="padding:4px;">
          <option value="0">æ—¥æ›œæ—¥</option>
          <option value="1">æœˆæ›œæ—¥</option>
          <option value="2">ç«æ›œæ—¥</option>
          <option value="3">æ°´æ›œæ—¥</option>
          <option value="4">æœ¨æ›œæ—¥</option>
          <option value="5">é‡‘æ›œæ—¥</option>
          <option value="6">åœŸæ›œæ—¥</option>
        </select>
      </div>
      <div class="time-inputs">
        <input type="number" id="eventStartHour" min="0" max="23" placeholder="æ™‚">
        <span>:</span>
        <input type="number" id="eventStartMinute" min="0" max="59" placeholder="åˆ†">
        <span>-</span>
        <input type="number" id="eventEndHour" min="0" max="23" placeholder="æ™‚">
        <span>:</span>
        <input type="number" id="eventEndMinute" min="0" max="59" placeholder="åˆ†">
      </div>
      <div style="display:flex;gap:6px;margin-top:10px;flex-wrap:wrap;">
        <button id="saveEvent">ä¿å­˜</button>
        <button id="deleteEvent" style="background:#ef4444;">å‰Šé™¤</button>
        <button id="copyNext" style="background:#16a34a;">æ¬¡ã®æœˆã«ã‚³ãƒ”ãƒ¼</button>
        <button id="cancelModal" style="background:#64748b;">é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

  <script>
    // --- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ©Ÿèƒ½ ---
    (() => {
      const calEl = document.getElementById('calendar');
      const titleEl = document.getElementById('monthTitle');
      let viewDate = new Date();
      let events = loadEvents();
      let selectedDate = null;
      let editingIndex = null;

      // ç¬¬n Xæ›œæ—¥ã‚’è¨ˆç®—ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼
      function getNthWeekday(date) {
        const day = date.getDay(); // 0:Sun, 1:Mon...
        const d = date.getDate();
        const n = Math.floor((d - 1) / 7) + 1;
        return { n, day };
      }

      // æŒ‡å®šå¹´æœˆã®ç¬¬n Xæ›œæ—¥ã®æ—¥ä»˜ã‚’å–å¾—ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼
      function getDateByNthWeekday(year, month, n, day) {
        const firstDayOfMonth = new Date(year, month, 1);
        const firstDayOfWeek = firstDayOfMonth.getDay();

        let offset = day - firstDayOfWeek;
        if (offset < 0) offset += 7;

        const firstOccurrence = 1 + offset;
        const targetDateNum = firstOccurrence + (n - 1) * 7;

        const targetDate = new Date(year, month, targetDateNum);

        // æœˆãŒå¤‰ã‚ã£ã¦ã—ã¾ã£ãŸå ´åˆã¯å­˜åœ¨ã—ãªã„ (ä¾‹: ç¬¬5é‡‘æ›œæ—¥ãŒãªã„å ´åˆãªã©)
        if (targetDate.getMonth() !== month) return null;

        return targetDate;
      }

      function loadEvents() {
        try { return JSON.parse(localStorage.getItem('pwaCal.events')) || {}; }
        catch { return {}; }
      }
      function saveEvents() {
        localStorage.setItem('pwaCal.events', JSON.stringify(events));
      }

      function renderCalendar() {
        const y = viewDate.getFullYear();
        const m = viewDate.getMonth();
        titleEl.textContent = `${y}å¹´ ${m + 1}æœˆ`;
        const first = new Date(y, m, 1);
        const last = new Date(y, m + 1, 0);
        const startDay = first.getDay();

        const days = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
        let html = '<tr>' + days.map(d => `<th>${d}</th>`).join('') + '</tr><tr>';
        for (let i = 0; i < startDay; i++) html += '<td></td>';

        for (let d = 1; d <= last.getDate(); d++) {
          const current = new Date(y, m, d);
          const key = current.toISOString().split('T')[0];
          html += `<td data-date="${key}" ondragover="event.preventDefault()">`;
          html += `<div class="date-num">${d}</div>`;
          const evts = events[key] || [];
          for (const [i, ev] of evts.entries()) {
            html += `<div class="event" draggable="true" data-idx="${i}" data-date="${key}">
          ${ev.time ? ev.time + ' ' : ''}${ev.title}</div>`;
          }
          html += '</td>';
          if ((startDay + d) % 7 === 0) html += '</tr><tr>';
        }
        html += '</tr>';
        calEl.innerHTML = html;

        // ã‚¤ãƒ™ãƒ³ãƒˆã‚¯ãƒªãƒƒã‚¯ç·¨é›†
        calEl.querySelectorAll('.event').forEach(el => {
          el.addEventListener('click', e => {
            e.stopPropagation();
            selectedDate = el.dataset.date;
            editingIndex = +el.dataset.idx;
            const data = events[selectedDate][editingIndex];
            document.getElementById('modalDate').textContent = selectedDate;
            document.getElementById('eventTitle').value = data.title;

            // æ›œæ—¥ã‚»ãƒ¬ã‚¯ã‚¿ã®åˆæœŸå€¤è¨­å®šï¼ˆé¸æŠã•ã‚ŒãŸæ—¥ã®æ›œæ—¥ï¼‰
            const d = new Date(selectedDate);
            // ä¿å­˜ã•ã‚ŒãŸæ›œæ—¥ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ã†ã€ãªã‘ã‚Œã°æ—¥ä»˜ã‹ã‚‰è¨ˆç®—
            document.getElementById('eventWeekday').value = (data.weekday !== undefined) ? data.weekday : d.getDay();

            // æ™‚é–“ã®ãƒ‘ãƒ¼ã‚¹ (HH:MM-HH:MM or HH:MM)
            const timeStr = data.time || '';
            const [startStr, endStr] = timeStr.split('-');

            if (startStr) {
              const [sh, sm] = startStr.split(':');
              document.getElementById('eventStartHour').value = sh || '';
              document.getElementById('eventStartMinute').value = sm || '';
            } else {
              document.getElementById('eventStartHour').value = '';
              document.getElementById('eventStartMinute').value = '';
            }

            if (endStr) {
              const [eh, em] = endStr.split(':');
              document.getElementById('eventEndHour').value = eh || '';
              document.getElementById('eventEndMinute').value = em || '';
            } else {
              document.getElementById('eventEndHour').value = '';
              document.getElementById('eventEndMinute').value = '';
            }

            document.getElementById('modal').style.display = 'flex';
          });

          // Dragé–‹å§‹
          el.addEventListener('dragstart', e => {
            e.dataTransfer.setData('text/plain', JSON.stringify({
              date: el.dataset.date,
              idx: el.dataset.idx
            }));
          });
        });

        // ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†
        calEl.querySelectorAll('td[data-date]').forEach(td => {
          td.addEventListener('drop', e => {
            e.preventDefault();
            const info = JSON.parse(e.dataTransfer.getData('text/plain'));
            const srcDate = info.date;
            const idx = +info.idx;
            const tgtDate = td.dataset.date;
            if (!events[srcDate] || !events[srcDate][idx]) return;

            // ã‚·ãƒ•ãƒˆã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚³ãƒ”ãƒ¼ã€æŠ¼ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ç§»å‹•
            if (e.shiftKey) {
              const item = { ...events[srcDate][idx] }; // ã‚³ãƒ”ãƒ¼
              if (!events[tgtDate]) events[tgtDate] = [];
              events[tgtDate].push(item);
            } else {
              const item = events[srcDate].splice(idx, 1)[0]; // ç§»å‹•ï¼ˆå…ƒã‹ã‚‰å‰Šé™¤ï¼‰
              if (!events[tgtDate]) events[tgtDate] = [];
              events[tgtDate].push(item);
            }

            saveEvents();
            renderCalendar();
          });

          // æ—¥ä»˜ã‚¯ãƒªãƒƒã‚¯ã§æ–°è¦è¿½åŠ 
          td.addEventListener('click', () => {
            selectedDate = td.dataset.date;
            editingIndex = null;
            document.getElementById('modalDate').textContent = selectedDate;
            document.getElementById('eventTitle').value = '';

            // æ›œæ—¥ã‚»ãƒ¬ã‚¯ã‚¿ã®åˆæœŸå€¤è¨­å®š
            const d = new Date(selectedDate);
            document.getElementById('eventWeekday').value = d.getDay();
            document.getElementById('eventStartHour').value = '';
            document.getElementById('eventStartMinute').value = '';
            document.getElementById('eventEndHour').value = '';
            document.getElementById('eventEndMinute').value = '';
            document.getElementById('modal').style.display = 'flex';
          });
        });
      }

      // æ“ä½œãƒœã‚¿ãƒ³
      document.getElementById('prevBtn').onclick = () => { viewDate.setMonth(viewDate.getMonth() - 1); renderCalendar(); };
      document.getElementById('nextBtn').onclick = () => { viewDate.setMonth(viewDate.getMonth() + 1); renderCalendar(); };
      document.getElementById('todayBtn').onclick = () => { viewDate = new Date(); renderCalendar(); };

      // ä»Šæœˆã®äºˆå®šã‚’æ¥æœˆã«ã‚³ãƒ”ãƒ¼
      document.getElementById('copyMonthBtn').onclick = () => {
        if (!confirm(`${viewDate.getFullYear()}å¹´${viewDate.getMonth() + 1}æœˆã®äºˆå®šã‚’ã™ã¹ã¦ç¿Œæœˆã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã‹ï¼Ÿ`)) return;

        const currentYear = viewDate.getFullYear();
        const currentMonth = viewDate.getMonth();

        // ç¿Œæœˆã®è¨ˆç®—
        const nextDate = new Date(currentYear, currentMonth + 1, 1);
        const nextYear = nextDate.getFullYear();
        const nextMonth = nextDate.getMonth();

        let copyCount = 0;
        let skipCount = 0;

        // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’èµ°æŸ»
        Object.keys(events).forEach(dateKey => {
          const dateParts = dateKey.split('-');
          const y = parseInt(dateParts[0]);
          const m = parseInt(dateParts[1]) - 1;
          const d = parseInt(dateParts[2]);

          // è¡¨ç¤ºä¸­ã®æœˆã®ã‚¤ãƒ™ãƒ³ãƒˆã®ã¿å¯¾è±¡
          if (y === currentYear && m === currentMonth) {
            const currentDate = new Date(y, m, d);
            const { n, day } = getNthWeekday(currentDate);

            // ç¿Œæœˆã®åŒã˜ ç¬¬n Xæ›œæ—¥ ã‚’è¨ˆç®—
            // evt.weekday ãŒã‚ã‚Œã°ãã‚Œã‚’å„ªå…ˆã€ãªã‘ã‚Œã° dateKey ã®æ›œæ—¥ã‚’ä½¿ç”¨
            let targetDay = day;
            // è¤‡æ•°ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒã‚ã‚‹å ´åˆã€ãã‚Œãã‚Œã®è¨­å®šã‚’è¦‹ã‚‹å¿…è¦ãŒã‚ã‚‹ãŒã€
            // ç¾åœ¨ã®æ§‹é€ ã§ã¯ events[dateKey] ã¯é…åˆ—ã€‚
            // å€‹åˆ¥ã®ã‚¤ãƒ™ãƒ³ãƒˆã”ã¨ã«ã‚³ãƒ”ãƒ¼å…ˆãŒå¤‰ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ãƒ«ãƒ¼ãƒ—å†…ã§å‡¦ç†ã™ã‚‹ã€‚

            // NOTE: events[dateKey] loop starts in lines below.
            // But targetDate is calculated OUTSIDE the loop in original code.
            // We must move targetDate calculation INSIDE the loop.

            // Original code structure was assuming all events on that day go to same target.
            // Now, events[dateKey][0] might want Tuesday, events[dateKey][1] might want Wednesday.

            // So we iterate events FIRST.
            events[dateKey].forEach(evt => {
              const preferredDay = (evt.weekday !== undefined) ? evt.weekday : day;

              const targetDate = getDateByNthWeekday(nextYear, nextMonth, n, preferredDay);

              if (targetDate) {
                // toISOString()ã¯UTCã«ãªã‚‹ãŸã‚ã€ãƒ­ãƒ¼ã‚«ãƒ«æ—¥ä»˜ã‹ã‚‰ç›´æ¥ç”Ÿæˆã™ã‚‹
                const ty = targetDate.getFullYear();
                const tm = String(targetDate.getMonth() + 1).padStart(2, '0');
                const td = String(targetDate.getDate()).padStart(2, '0');
                const targetKey = `${ty}-${tm}-${td}`;

                if (!events[targetKey]) events[targetKey] = [];
                events[targetKey].push({ ...evt });
                copyCount++;
              } else {
                skipCount++;
              }
            });
          }
        });

        saveEvents();
        alert(`${copyCount}ä»¶ã®äºˆå®šã‚’ç¿Œæœˆã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚${skipCount > 0 ? `\n(${skipCount}ä»¶ã¯ç¿Œæœˆã«è©²å½“ã™ã‚‹æ›œæ—¥ãŒå­˜åœ¨ã—ãªã„ãŸã‚ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸ)` : ''}`);
        renderCalendar();
      };

      document.getElementById('deleteMonthBtn').onclick = () => {
        if (!confirm(`${viewDate.getFullYear()}å¹´${viewDate.getMonth() + 1}æœˆã®äºˆå®šã‚’å…¨ã¦å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`)) return;

        const currentYear = viewDate.getFullYear();
        const currentMonth = viewDate.getMonth();
        let deleteCount = 0;

        Object.keys(events).forEach(dateKey => {
          const dateParts = dateKey.split('-');
          const y = parseInt(dateParts[0]);
          const m = parseInt(dateParts[1]) - 1;

          if (y === currentYear && m === currentMonth) {
            delete events[dateKey];
            deleteCount++;
          }
        });

        saveEvents();
        renderCalendar();
        alert(`${deleteCount}æ—¥åˆ†ã®äºˆå®šã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
      };

      document.getElementById('printBtn').onclick = () => window.print();

      // ãƒ¢ãƒ¼ãƒ€ãƒ«æ“ä½œ
      document.getElementById('saveEvent').onclick = () => {
        const title = document.getElementById('eventTitle').value.trim();
        const weekday = parseInt(document.getElementById('eventWeekday').value);
        // æ™‚é–“ã®çµåˆ
        const sh = document.getElementById('eventStartHour').value;
        const sm = document.getElementById('eventStartMinute').value;
        const eh = document.getElementById('eventEndHour').value;
        const em = document.getElementById('eventEndMinute').value;

        let time = '';
        if (sh || sm) {
          const startHH = (sh || '0').padStart(2, '0');
          const startMM = (sm || '0').padStart(2, '0');
          time = `${startHH}:${startMM}`;

          if (eh || em) {
            const endHH = (eh || '0').padStart(2, '0');
            const endMM = (em || '0').padStart(2, '0');
            time += `-${endHH}:${endMM}`;
          }
        }

        if (!title) return alert('ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        if (!events[selectedDate]) events[selectedDate] = [];
        if (editingIndex != null) {
          events[selectedDate][editingIndex] = { title, time, weekday };
        } else {
          events[selectedDate].push({ title, time, weekday });
        }
        saveEvents();
        document.getElementById('modal').style.display = 'none';
        renderCalendar();
      };
      document.getElementById('deleteEvent').onclick = () => {
        if (editingIndex == null) return;
        if (confirm('ã“ã®äºˆå®šã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
          events[selectedDate].splice(editingIndex, 1);
          saveEvents();
          document.getElementById('modal').style.display = 'none';
          renderCalendar();
        }
      };
      document.getElementById('copyNext').onclick = () => {
        if (editingIndex == null) return;
        const src = events[selectedDate][editingIndex];
        const base = new Date(selectedDate);

        // ç¬¬n Xæ›œæ—¥åŸºæº–ã§ã‚³ãƒ”ãƒ¼
        // nã¯å…ƒã®æ—¥ä»˜ã‹ã‚‰è¨ˆç®—ã—ã€æ›œæ—¥ã¯ã‚»ãƒ¬ã‚¯ã‚¿ã®å€¤ã‚’ä½¿ç”¨ã™ã‚‹
        const { n } = getNthWeekday(base);
        const selectedDay = parseInt(document.getElementById('eventWeekday').value);

        // ç¿Œæœˆ
        const nextMonthDate = new Date(base.getFullYear(), base.getMonth() + 1, 1);
        const targetDate = getDateByNthWeekday(nextMonthDate.getFullYear(), nextMonthDate.getMonth(), n, selectedDay);

        if (targetDate) {
          const ty = targetDate.getFullYear();
          const tm = String(targetDate.getMonth() + 1).padStart(2, '0');
          const td = String(targetDate.getDate()).padStart(2, '0');
          const key = `${ty}-${tm}-${td}`;

          if (!events[key]) events[key] = [];
          events[key].push({ ...src });
          saveEvents();
          alert(`æ¥æœˆã®ç¬¬${n}${['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'][selectedDay]}æ›œæ—¥ï¼ˆ${key}ï¼‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ`);
        } else {
          alert(`æ¥æœˆã«ã¯ç¬¬${n}${['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'][selectedDay]}æ›œæ—¥ãŒå­˜åœ¨ã—ã¾ã›ã‚“`);
        }
      };
      document.getElementById('cancelModal').onclick = () => { document.getElementById('modal').style.display = 'none'; };

      renderCalendar();
    })();

    // --- âœ… PWA Service Worker ç™»éŒ² ---
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(() => console.log('ServiceWorkerç™»éŒ²æˆåŠŸ'))
        .catch(e => console.log('SWç™»éŒ²å¤±æ•—', e));
    }
  </script>
</body>

</html>